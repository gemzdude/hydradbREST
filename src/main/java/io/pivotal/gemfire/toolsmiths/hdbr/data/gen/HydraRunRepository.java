package io.pivotal.gemfire.toolsmiths.hdbr.data.gen;

import io.pivotal.gemfire.toolsmiths.hdbr.data.JdbcRepository;
import io.pivotal.gemfire.toolsmiths.hdbr.data.RowUnmapper;
import io.pivotal.gemfire.toolsmiths.hdbr.data.gen.db.HydraRunDB;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.repository.query.Param;
import org.springframework.jdbc.core.JdbcOperations;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * This class is generated by Spring Data Jdbc code generator.
 *
 * @author Spring Data Jdbc Code Generator
 */
@Repository
public class HydraRunRepository extends JdbcRepository<HydraRun, Integer>
{

	final static Logger logger = LoggerFactory.getLogger (HydraRunRepository.class);

	@Autowired
	private JdbcOperations jdbcOperations;

	protected JdbcOperations getJdbcOperations()
	{
		return this.jdbcOperations;
	}

	public HydraRunRepository()
	{
		super (HydraRunDB.ROW_MAPPER, HydraRunDB.ROW_UNMAPPER, HydraRunDB.getTableName ());
	}

	public HydraRunRepository(RowMapper<HydraRun> rowMapper, RowUnmapper<HydraRun> rowUnmapper, String idColumn)
	{
		super (HydraRunDB.ROW_MAPPER, HydraRunDB.ROW_UNMAPPER, HydraRunDB.getTableName (), idColumn);
	}

	@Override
	protected HydraRun postCreate(HydraRun entity, Number generatedId)
	{
		entity.setId(generatedId.intValue());
		entity.setPersisted(true);
		return entity;
	}

	/* START Do not remove/edit this line. CodeGenerator will preserve any code between start and end tags.*/

	@Autowired
	private JdbcTemplate jdbcTemplate;

	public List<Integer> findByLoc(@Param("buildLocation") String buildLocation) {
		String sql = "SELECT id FROM " + HydraRunDB.getTableName() + " WHERE build_location = ?";
		sql = sql + " LIMIT 50";
		List<Integer> intList = (List<Integer>)jdbcTemplate.queryForList(
				sql, new Object[] { buildLocation }, Integer.class);
		return intList;
	}

	public Integer findMax() {
		String sql = "SELECT max(id) FROM " + HydraRunDB.getTableName();
		List<Integer> hr = (List<Integer>)jdbcTemplate.queryForList(
				sql, Integer.class);
		return hr.get(0);
	}

	/* END Do not remove/edit this line. CodeGenerator will preserve any code between start and end tags.*/

}

